# Supervisor configuration for Giga-PDF on Ploi
# This file can be used as reference for Ploi daemon configuration

[program:gigapdf-horizon]
process_name=%(program_name)s
command=php /home/ploi/giga-pdf/artisan horizon
autostart=true
autorestart=true
user=ploi
redirect_stderr=true
stdout_logfile=/home/ploi/giga-pdf/storage/logs/horizon.log
stopwaitsecs=3600
startsecs=10
stopasgroup=true
killasgroup=true

[program:gigapdf-reverb]
process_name=%(program_name)s
command=php /home/ploi/giga-pdf/artisan reverb:start --host=0.0.0.0 --port=8080
autostart=true
autorestart=true
user=ploi
redirect_stderr=true
stdout_logfile=/home/ploi/giga-pdf/storage/logs/reverb.log
startsecs=10

[program:gigapdf-queue-default]
process_name=%(program_name)s_%(process_num)02d
command=php /home/ploi/giga-pdf/artisan queue:work --sleep=3 --tries=3 --max-time=3600
autostart=true
autorestart=true
user=ploi
numprocs=2
redirect_stderr=true
stdout_logfile=/home/ploi/giga-pdf/storage/logs/queue-default.log
stopwaitsecs=10
startsecs=5

[program:gigapdf-queue-conversions]
process_name=%(program_name)s_%(process_num)02d
command=php /home/ploi/giga-pdf/artisan queue:work --queue=conversions --sleep=3 --tries=2 --timeout=300 --memory=256
autostart=true
autorestart=true
user=ploi
numprocs=3
redirect_stderr=true
stdout_logfile=/home/ploi/giga-pdf/storage/logs/queue-conversions.log
stopwaitsecs=60
startsecs=5

[program:gigapdf-queue-emails]
process_name=%(program_name)s
command=php /home/ploi/giga-pdf/artisan queue:work --queue=emails --sleep=3 --tries=3
autostart=true
autorestart=true
user=ploi
redirect_stderr=true
stdout_logfile=/home/ploi/giga-pdf/storage/logs/queue-emails.log
stopwaitsecs=10
startsecs=5

[program:gigapdf-scheduler]
process_name=%(program_name)s
command=php /home/ploi/giga-pdf/artisan schedule:work
autostart=true
autorestart=true
user=ploi
redirect_stderr=true
stdout_logfile=/home/ploi/giga-pdf/storage/logs/scheduler.log
stopwaitsecs=10
startsecs=5

[group:gigapdf]
programs=gigapdf-horizon,gigapdf-reverb,gigapdf-queue-default,gigapdf-queue-conversions,gigapdf-queue-emails,gigapdf-scheduler